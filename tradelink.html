<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FKR Trade 링크 생성기</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            /* max-width: 1400px; */
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .header-section {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .header-section:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        .content-section {
            display: flex;
            flex-direction: column;
            /* gap: 20px; */
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            flex: 1;
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .template-section, .result-section, .preview-section {
            background-color: white;
            padding: 25px;
            transition: all 0.3s ease;
        }
        .template-section {
            flex: 1;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding:0px 25px 25px 25px;
        }
        .result-section {
            flex: 1;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .preview-section {
            flex: 2;
            max-width:500px;
            transition: all 0.3s ease;
        }
        .preview-section.folded {
            max-width: 0;
            padding: 0;
            overflow: hidden;
        }
        .preview-frame {
            width: 100%;
            height: 100%;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .preview-frame:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
    
        h1, h2 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-top: 0;
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #3498db, #8e44ad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
        }
        input {
            width: 100%;
            padding: 6px;
            margin-bottom: 18px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        input:hover {
            border-color: #bbb;
        }
        select {
            width: 100%;
            padding: 6px;
            margin-bottom: 18px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        select:hover {
            border-color: #bbb;
        }

        
        .link-list {
            list-style-type: none;
            padding: 0;
        }
        .link-item {
            font-size: 14px;
            display: flex;
            margin-bottom: 7px;
            padding: 4px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            height: 26px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .link-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.06);
            transform: translateY(-2px);
        }
        .template-link, .generated-link {
            flex: 1;
            padding: 0 10px;
        }
        .template-link input {
            font-size: 12px;
            margin-bottom: 0;
            border-radius: 6px;
        }
        .generated-link a {
            color: #2980b9;
            word-break: break-all;
            text-decoration: none;
            display: block;
            padding: 0px 10px;
            background-color: #e9f5ff;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-top: 3px;
        }
        .generated-link a:hover {
            background-color: #d4ebff;
            text-decoration: underline;
            transform: translateY(-1px);
        }
        .list-controls {
            display: flex;
            justify-content: flex-start;
            /* margin-bottom: 15px; */
            padding: 10px 12px;
            /* padding-top: 25px; */
        }
        .list-header {
            font-size: 14px;
            /* display: flex; */
            margin-bottom: 15px;
            font-weight: 700;
            border-bottom: 2px solid #3498db;
            padding-bottom: 12px;
            justify-content: flex-start;
            align-items: center;
            color: #2c3e50;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            background: linear-gradient(to right, #f8f9fa, white);
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            
            display:none;
        }
        .list-header div {
            padding: 0 10px;
        }
        .list-header div:first-child {
            flex: 0 0 auto;
        }
        .list-header div:nth-child(2) {
            flex: 1;
        }
        .fold-button {
            cursor: pointer;
            padding: 8px;
            z-index: 10;
            transition: all 0.3s ease;
            color: #3498db;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }
        .fold-button.folded {
            transform: rotate(-90deg);
            background-color: rgba(52, 152, 219, 0.2);
        }
        .template-section.folded .link-list {
            display: none;
        }
        .template-section.folded .list-header {
            margin-bottom: 0;
            border-bottom: none;
            background: linear-gradient(to right, #e9f5ff, white);
        }
        
        .field-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .field-item {
            flex: 1;
        }
        
        .icon-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-right: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3px;
            border-radius: 10px;
            transition: all 0.3s ease-in-out;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            isolation: isolate;
        }
    
        .icon-button:hover {
            transform: translateY(-3px);
            box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #2980b9, #1c638e);
        }
    
        .icon-button:active {
            transform: translateY(1px);
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
        }
    
        .icon-button svg {
            width: 24px;
            height: 24px;
            fill: white;
        }
    
        .icon-button[title]:hover::after {
            content: attr(title);
            position: absolute;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            background-color: #2c3e50;
            color: #ffffff;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 12px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
            opacity: 1;
            pointer-events: none;
            z-index: 10;
        }
    
        #remove-template-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        #remove-template-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a33025);
        }
        
        /* Add a subtle animation for the fold button */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .fold-button:hover svg {
            animation: pulse 1s infinite;
        }
        .show {
            display:block;
        }
        .reflabel {
            font-size: 11px;
            padding: 12px 6px 0px 7px;
            color: silver;
        }
        .flex {
            display:flex;
        }

        
        

        
        /* Navigation menu for mobile and tablet */
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 12px;
            border-bottom: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        .mobile-nav ul {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            justify-content: space-around;
            gap: 8px;
        }
        
        .mobile-nav li {
            flex: 1;
            margin: 0;
        }
        
        .mobile-nav a {
            text-decoration: none;
            color: #2c3e50;
            font-weight: 600;
            font-size: 13px;
            padding: 10px 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: block;
            text-align: center;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid rgba(52, 152, 219, 0.1);
        }
        
        .mobile-nav a:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
        }
        
        .mobile-nav a.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
        }







        @media screen and (max-width: 1024px) {
            .mobile-nav {
                display: block !important;
            }
            
            body {
                padding-top: 65px !important;
            }

            .container {
                flex-direction: column;
            }
            
            .preview-section {
                max-width: 100%;
            }
            
            .preview-frame {
                min-height: 400px;
            }
            
            .header-section {
                margin-bottom: 15px;
            }
            
            .content-section {
                margin-bottom: 15px;
            }
        }

        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                gap: 10px;
            }
            
            .header-section,
            .template-section,
            .result-section,
            .preview-section {
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .field-row {
                flex-direction: column;
                gap: 0;
            }
            
            .preview-frame {
                min-height: 300px;
            }
        }

        @media screen and (max-width: 480px) {
            .header-section,
            .template-section,
            .result-section,
            .preview-section {
                padding: 10px;
            }
            
            .list-controls {
                padding: 5px;
            }
            
            .link-item {
                font-size: 12px;
            }
            
            .generated-link a {
                font-size: 12px;
            }
            .mobile-nav a {
                font-size: 12px;
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Add mobile navigation menu -->
    <nav class="mobile-nav">
        <ul>
            <li><a href="#header-section" class="nav-link">설정</a></li>
            <li><a href="#template-section" class="nav-link">템플릿</a></li>
            <li><a href="#result-section" class="nav-link">결과</a></li>
            <!-- <li><a href="#preview-section" class="nav-link">미리보기</a></li> -->
        </ul>
    </nav>

    <h1>FKR Trade 링크 생성기</h1>
    
    <div class="container">
        <div id="header-section" class="header-section">
            <label for="base-url">BASE URL</label>
            <input type="text" id="base-url" placeholder="https://example.com" />
            
            <!-- 추가 입력 필드 -->
            <div class="additional-fields">
                <div class="field-item">
                    <label for="ticker">ticker</label>
                    <input type="text" id="ticker" placeholder="티커 값 입력" />
                </div>
                <div class="field-item">
                    <label for="seq">seq</label>
                    <input type="number" id="seq" placeholder="시퀀스 값 입력" />
                </div>
                <div class="field-item">
                    <label for="condTypeCd">condTypeCd</label>
                    <select id="condTypeCd">
                        <option value="">선택하세요</option>
                        <option value="buy">buy</option>
                        <option value="sell">sell</option>
                        <option value="period_in">period_in</option>
                        <option value="period_out">period_out</option>
                    </select>
                </div>
                <div class="field-row">
                </div>
                <div class="field-item">
                    <label for="topPrice">topPrice</label>
                    <input type="text" id="topPrice" placeholder="상단가 입력" />
                </div>
                <div class="field-item">
                    <label for="botmPrice">botmPrice</label>
                    <input type="text" id="botmPrice" placeholder="하단가 입력" />
                </div>
                <div class="field-item">
                    <label for="tradePrice">tradePrice</label>
                    <select id="tradePrice">
                        <option value="">선택하세요</option>
                        <option value="1000000">100만원</option>
                        <option value="2000000">200만원</option>
                        <option value="3000000">300만원</option>
                        <option value="4000000">400만원</option>
                        <option value="5000000">500만원</option>
                        <option value="10000000">1000만원</option>
                    </select>
                </div>
                <div class="field-row">
                </div>
            </div>
            
            
        </div>



        <div class="content-section">
            
            <div class="template-section" id="template-section">
                <div class="list-header">
                    <!-- <div class="fold-button" title="접기/펼치기">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                    </div> -->
                    <div>템플릿 링크</div>
                </div>
                <div class="list-controls">
                    <!-- 템플릿 추가 버튼 -->
                    <button id="add-template-btn" class="icon-button" title="템플릿 추가">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" fill="#4CAF50">
                            <path d="M480 800q-17 0-28.5-11.5T440 760V576H256q-17 0-28.5-11.5T216 536q0-17 11.5-28.5T256 496h184V312q0-17 11.5-28.5T480 272q17 0 28.5 11.5T520 312v184h184q17 0 28.5 11.5T744 536q0 17-11.5 28.5T704 576H520v184q0 17-11.5 28.5T480 800Z"/>
                        </svg>
                    </button>
                
                    <!-- 템플릿 삭제 버튼 -->
                    <button id="remove-template-btn" class="icon-button" title="템플릿 삭제" style="background: linear-gradient(135deg, #FF5252, #FF1744);">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" fill="#FFFFFF">
                            <path d="M312 896q-35 0-59.5-24.5T228 812V316H200q-13 0-21.5-8.5T170 286q0-13 8.5-21.5T200 256h160v-40q0-17 11.5-28.5T400 176h160q17 0 28.5 11.5T600 216v40h160q13 0 21.5 8.5T790 286q0 13-8.5 21.5T760 316h-28v496q0 35-24.5 59.5T648 896H312Zm336-580H312v496h336V316Zm-209 413q13 0 21.5-8.5T469 700V500q0-13-8.5-21.5T439 470q-13 0-21.5 8.5T409 500v200q0 13 8.5 21.5T439 729Zm100 0q13 0 21.5-8.5T569 700V500q0-13-8.5-21.5T539 470q-13 0-21.5 8.5T509 500v200q0 13 8.5 21.5T539 729Z"/>
                        </svg>
                    </button>
                
                    <!-- 링크 생성 버튼
                    <button id="generate-btn" class="icon-button" title="링크 생성" style="background: linear-gradient(135deg, #2196F3, #0b7dda);">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" fill="#FFFFFF">
                            <path d="M394 756H300q-57 0-96.5-39.5T164 620q0-57 39.5-96.5T300 484h94q17 0 28.5 11.5T434 524q0 17-11.5 28.5T394 564H300q-30 0-51 21t-21 51q0 30 21 51t51 21h94q17 0 28.5 11.5T434 696q0 17-11.5 28.5T394 736ZM408 596v-40q0-17-11.5-28.5T368 516H256q-30 0-51-21t-21-51q0-30 21-51t51-21h112q17 0 28.5-11.5T408 356q0-17-11.5-28.5T368 316H256q-57 0-96.5 39.5T120 456q0 57 39.5 96.5T256 556h112q17 0 28.5 11.5T408 596Z"/>
                        </svg>
                    </button> -->
                </div>
                <div class="reflabel""">&lt;ticker&gt;, &lt;seq&gt;, &lt;condTypeCd&gt;, &lt;topPrice&gt;, &lt;botmPrice&gt;, &lt;tradePrice&gt; 등이 대체됩니다</div>
                <ul id="template-list" class="link-list">
                    <!-- <li class="link-item">
                        <div class="template-link">
                            <input type="text" class="template-input" placeholder="예: /path?ticker=<ticker>&condTypeCd=<condTypeCd>" />
                        </div>
                    </li> -->
                </ul>
            </div>
            </div>
            
            <div class="result-section" id="result-section">
                <div class="list-header">
                    <div></div>
                    <div>생성된 링크 (클릭하면 미리보기에 표시됩니다)</div>
                </div>
                <ul id="result-list" class="link-list">
                    <!-- <li class="link-item">
                        <div class="generated-link">
                            <span>필요한 값을 입력하고 링크를 생성하세요.</span>
                        </div>
                    </li> -->
                </ul>
            </div>
            
            <div class="preview-section" id="preview-section">
                <div class="list-header show flex">
                    <div class="fold-button" title="미리보기 접기/펼치기">
                        <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                    </div>
                    <div>링크 미리보기</div>
                </div>
                <iframe id="preview-frame" class="preview-frame" src="about:blank"></iframe>
            </div>
            
            <div id="result-datalist"></div>
        </div>
    </div>

<script>
    // DOM이 완전히 로드된 후 실행되도록 함수 정의
    function initApp() {
        const baseUrlInput = document.getElementById('base-url');
        const tickerInput = document.getElementById('ticker');
        const seqInput = document.getElementById('seq');
        const condTypeCdInput = document.getElementById('condTypeCd');
        const topPriceInput = document.getElementById('topPrice');
        const botmPriceInput = document.getElementById('botmPrice');
        const tradePriceInput = document.getElementById('tradePrice');
        const templateList = document.getElementById('template-list');
        const resultList = document.getElementById('result-list');
        const addTemplateBtn = document.getElementById('add-template-btn');
        const removeTemplateBtn = document.getElementById('remove-template-btn');
        // const generateBtn = document.getElementById('generate-btn');
        
        // 템플릿 섹션 폴딩 기능 추가
        // const templateSection = document.querySelector('.template-section');
        // const foldButton = document.querySelector('.fold-button');
        
        // if (foldButton) {
        //     foldButton.addEventListener('click', function() {
        //         templateSection.classList.toggle('folded');
        //         this.classList.toggle('folded');
                
        //         // 폴딩 상태 저장
        //         localStorage.setItem('templateSectionFolded', templateSection.classList.contains('folded'));
        //     });
            
        //     // 저장된 폴딩 상태 불러오기
        //     const isFolded = localStorage.getItem('templateSectionFolded') === 'true';
        //     if (isFolded) {
        //         templateSection.classList.add('folded');
        //         foldButton.classList.add('folded');
        //     }
        // }


        
        // 모바일 네비게이션 기능 추가
        function initMobileNav() {
            const navLinks = document.querySelectorAll('.nav-link');
            
            // 네비게이션 링크 클릭 이벤트 처리
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 모든 링크에서 active 클래스 제거
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // 클릭된 링크에 active 클래스 추가
                    this.classList.add('active');
                    
                    // 대상 섹션으로 스크롤
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        // 스크롤 애니메이션
                        window.scrollTo({
                            top: targetElement.offsetTop - 60, // 네비게이션 높이만큼 오프셋 적용
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            // 스크롤 이벤트에 따라 현재 섹션 하이라이트
            window.addEventListener('scroll', function() {
                const scrollPosition = window.scrollY + 70; // 네비게이션 높이 + 여유 공간
                
                // 각 섹션의 위치 확인
                const sections = [
                    document.getElementById('header-section'),
                    document.getElementById('template-section'),
                    document.getElementById('result-section'),
                    document.getElementById('preview-section')
                ];
                
                // 현재 보이는 섹션 찾기
                let currentSection = null;
                
                sections.forEach(section => {
                    if (section) {
                        const sectionTop = section.offsetTop;
                        const sectionBottom = sectionTop + section.offsetHeight;
                        
                        if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                            currentSection = section.id;
                        }
                    }
                });
                
                // 해당 네비게이션 링크 활성화
                if (currentSection) {
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + currentSection) {
                            link.classList.add('active');
                        }
                    });
                }
            });
            
            // 초기 로드 시 현재 섹션 하이라이트
            setTimeout(() => {
                window.dispatchEvent(new Event('scroll'));
            }, 100);
        }
        
        // 모바일 네비게이션 초기화
        initMobileNav();

        
        // 미리보기 섹션 폴딩 기능 추가
        const previewSection = document.querySelector('.preview-section');
        const previewFoldButton = previewSection.querySelector('.fold-button');
        
        if (previewFoldButton) {
            previewFoldButton.addEventListener('click', function() {
                previewSection.classList.toggle('folded');
                this.classList.toggle('folded');
                
                // 폴딩 상태 저장
                localStorage.setItem('previewSectionFolded', previewSection.classList.contains('folded'));
            });
            
            // 저장된 폴딩 상태 불러오기
            const isPreviewFolded = localStorage.getItem('previewSectionFolded') === 'true';
            if (isPreviewFolded) {
                previewSection.classList.add('folded');
                previewFoldButton.classList.add('folded');
            }
        }
        
        // DataList 컴포넌트 초기화
        let resultDataList;
        let resultData = [];
        
        // DataList 컬럼 정의
        const columns = [
            {headerText: "템플릿", key: "template", width: 200},
            {headerText: "생성된 링크", key: "link", width: 400}
        ];
        
        // DataList 옵션 설정
        const options = {
            width: "100%",
            pageRowSize: 10,
            pageInfoVisible: true,
            pageControlsVisible: true
        };
        
        // DataList 초기화 함수
        function initDataList() {
            resultDataList = DataList(document.getElementById("result-datalist"), columns, options);
            
            // 더블 클릭 이벤트 설정 - 링크 열기
            resultDataList.setOnDoubleClick(function(rowData) {
                if (rowData.link && rowData.link !== '템플릿 링크를 입력해주세요.' && !rowData.link.includes('❌')) {
                    window.open(rowData.link, '_blank');
                }
            });
            
            resultDataList.setData(resultData);
        }
        // 추가 필드 입력 이벤트 리스너
        tickerInput.addEventListener('input', function() {
            saveTicker();
            updateAllLinks();
        });
        
        seqInput.addEventListener('input', function() {
            saveSeq();
            updateAllLinks();
        });

        // condTypeCd 입력 이벤트 리스너 추가
        condTypeCdInput.addEventListener('input', function() {
            savecondTypeCd();
            updateAllLinks();
        });
        
        topPriceInput.addEventListener('input', function() {
            saveTopPrice();
            updateAllLinks();
        });
        
        botmPriceInput.addEventListener('input', function() {
            saveBotmPrice();
            updateAllLinks();
        });
        
        tradePriceInput.addEventListener('input', function() {
            saveTradePrice();
            updateAllLinks();
        });
        
        // BASE_URL 입력 필드 값 변경 감지 및 저장
        baseUrlInput.addEventListener('input', function() {
            saveBaseUrl();
            updateAllLinks(); // 모든 링크 업데이트
        });
        
        // 템플릿 추가 버튼
        addTemplateBtn.addEventListener('click', function() {
            addTemplateItem();
        });
        
        // 템플릿 항목 추가 함수
        function addTemplateItem(templateValue = '') {
            const newItem = document.createElement('li');
            newItem.className = 'link-item';
            newItem.innerHTML = `
                <div class="template-link">
                    <input type="text" class="template-input" value="${templateValue}" placeholder="예: /path?ticker=<ticker>&condTypeCd=<condTypeCd>" />
                </div>
            `;
            templateList.appendChild(newItem);
            
            // 결과 리스트에도 빈 항목 추가
            const newResultItem = document.createElement('li');
            newResultItem.className = 'link-item';
            newResultItem.innerHTML = `
                <div class="generated-link">
                    <span>필요한 값을 입력하고 링크를 생성하세요.</span>
                </div>
            `;
            resultList.appendChild(newResultItem);
            
            // 템플릿 입력 필드에 이벤트 리스너 추가
            const templateInput = newItem.querySelector('.template-input');
            templateInput.addEventListener('input', function() {
                saveTemplates();
                // 해당 템플릿의 결과 링크만 업데이트
                const index = Array.from(templateList.children).indexOf(newItem);
                updateLinkAtIndex(index);
            });
            
            // 템플릿 저장
            saveTemplates();
            
            // 새로 추가된 템플릿의 링크 업데이트
            const index = templateList.children.length - 1;
            updateLinkAtIndex(index);
        }
        
        // 템플릿 삭제 버튼
        removeTemplateBtn.addEventListener('click', function() {
            const templateItems = templateList.querySelectorAll('.link-item');
            const resultItems = resultList.querySelectorAll('.link-item');
            
            if (templateItems.length > 0) {
                templateList.removeChild(templateItems[templateItems.length - 1]);
                resultList.removeChild(resultItems[resultItems.length - 1]);
                
                // 템플릿 저장
                saveTemplates();
            } else {
                // alert('최소 하나의 템플릿은 유지해야 합니다.');
            }
        });
        
        // 링크 생성 버튼
        // generateBtn.addEventListener('click', function() {
        //     updateAllLinks();
        // });
        
        // 특정 인덱스의 링크만 업데이트하는 함수
        function updateLinkAtIndex(index) {
            const baseUrl = baseUrlInput.value.trim();
            const ticker = tickerInput.value.trim();
            const seq = seqInput.value.trim();
            const condTypeCd = condTypeCdInput.value.trim(); // condTypeCd 값 가져오기
            const topPrice = topPriceInput.value.trim();
            const botmPrice = botmPriceInput.value.trim();
            const tradePrice = tradePriceInput.value.trim();
            
            const templateItems = templateList.querySelectorAll('.link-item');
            const resultItems = resultList.querySelectorAll('.link-item');
            
            if (index >= templateItems.length || index >= resultItems.length) {
                return;
            }
            
            const templateInput = templateItems[index].querySelector('.template-input');
            const resultItem = resultItems[index];
            
            let templateLink = templateInput.value.trim();
            
            if (!templateLink) {
                resultItem.innerHTML = `
                    <div class="generated-link">
                        <span>템플릿 링크를 입력해주세요.</span>
                    </div>
                `;
                return;
            }
            
            // 링크 생성 로직
            let generatedLink = templateLink;
            let generatedLinkUrl = templateLink;
            
            // 플레이스홀더 대체
            if (generatedLink.includes('<ticker>')) {
                generatedLink = generatedLink.replace(/<ticker>/g, ticker || '❌');
            }
            if (generatedLink.includes('<seq>')) {
                generatedLink = generatedLink.replace(/<seq>/g, seq || '❌');
            }
            // condTypeCd 플레이스홀더 대체 추가
            if (generatedLink.includes('<condTypeCd>')) {
                generatedLink = generatedLink.replace(/<condTypeCd>/g, condTypeCd || '❌');
            }
            if (generatedLink.includes('<topPrice>')) {
                generatedLink = generatedLink.replace(/<topPrice>/g, topPrice || '❌');
            }
            if (generatedLink.includes('<botmPrice>')) {
                generatedLink = generatedLink.replace(/<botmPrice>/g, botmPrice || '❌');
            }
            if (generatedLink.includes('<tradePrice>')) {
                generatedLink = generatedLink.replace(/<tradePrice>/g, tradePrice || '❌');
            }
            
            // BASE_URL 추가 (맨 앞에 추가)
            if (baseUrl) {
                // URL이 이미 http:// 또는 https://로 시작하는지 확인
                if (!generatedLink.match(/^https?:\/\//)) {
                    // 슬래시 중복 방지
                    if (baseUrl.endsWith('/') && generatedLink.startsWith('/')) {
                        generatedLinkUrl = baseUrl + generatedLink.substring(1);
                    } else if (!baseUrl.endsWith('/') && !generatedLink.startsWith('/')) {
                        generatedLinkUrl = baseUrl + '/' + generatedLink;
                    } else {
                        generatedLinkUrl = baseUrl + generatedLink;
                    }
                } else {
                    generatedLinkUrl = generatedLink;
                }
            }
            
            resultItem.innerHTML = `
                <div class="generated-link">
                    <a href="${generatedLinkUrl}" target="_blank">${generatedLink}</a>
                </div>
            `;
            
            
            // 링크 클릭 이벤트 추가 - iframe에 표시
            const linkElement = resultItem.querySelector('a');
            if (linkElement) {
                linkElement.addEventListener('click', function(e) {
                    e.preventDefault();
                    const previewFrame = document.getElementById('preview-frame');
                    const previewSection = document.querySelector('.preview-section');
                    
                    // 링크에 /ins 또는 /del이 포함되어 있는지 확인
                    if (this.href.includes('/ins') || this.href.includes('/del')) {
                        // 확인 대화상자 표시
                        const action = this.href.includes('/ins') ? '추가' : '삭제';
                        const confirmMessage = `이 링크는 ${action} 작업을 수행합니다. 계속하시겠습니까?`;
                        
                        if (confirm(confirmMessage)) {
                            // 사용자가 확인한 경우
                            if (previewSection.classList.contains('folded')) {
                                // 미리보기가 접혀있을 때는 새 탭으로 열기
                                window.open(this.href, '_blank');
                            } else if (previewFrame && !this.href.includes('❌')) {
                                // 미리보기가 펼쳐져 있을 때는 iframe에 표시
                                previewFrame.src = this.href;
                            }
                        }
                    } else {
                        // 일반 링크인 경우 기존 로직 실행
                        if (previewSection.classList.contains('folded')) {
                            // 미리보기가 접혀있을 때는 새 탭으로 열기
                            window.open(this.href, '_blank');
                        } else if (previewFrame && this.href && !this.href.includes('❌')) {
                            // 미리보기가 펼쳐져 있을 때는 iframe에 표시
                            previewFrame.src = this.href;
                        }
                    }
                });
            }

        }
        
        // 모든 링크 업데이트 함수
        function updateAllLinks() {
            const templateItems = templateList.querySelectorAll('.link-item');
            
            for (let i = 0; i < templateItems.length; i++) {
                updateLinkAtIndex(i);
            }
        }
        
        // 템플릿을 localStorage에 저장하는 함수
        function saveTemplates() {
            const templateInputs = document.querySelectorAll('.template-input');
            const templates = Array.from(templateInputs).map(input => input.value);
            localStorage.setItem('fkrtmps', JSON.stringify(templates));
        }
        
        // BASE_URL을 localStorage에 저장하는 함수
        function saveBaseUrl() {
            localStorage.setItem('fkrbaseurl', baseUrlInput.value);
        }
        
        // Ticker를 localStorage에 저장하는 함수
        function saveTicker() {
            localStorage.setItem('fkrticker', tickerInput.value);
        }
        
        // Seq를 localStorage에 저장하는 함수
        function saveSeq() {
            localStorage.setItem('fkrseq', seqInput.value);
        }

        // condTypeCd를 localStorage에 저장하는 함수 추가
        function savecondTypeCd() {
            localStorage.setItem('fkrcondTypeCd', condTypeCdInput.value);
        }
        
        // TopPrice를 localStorage에 저장하는 함수
        function saveTopPrice() {
            localStorage.setItem('fkrtopprice', topPriceInput.value);
        }
        
        // BotmPrice를 localStorage에 저장하는 함수
        function saveBotmPrice() {
            localStorage.setItem('fkrbotmprice', botmPriceInput.value);
        }
        
        // TradePrice를 localStorage에 저장하는 함수
        function saveTradePrice() {
            localStorage.setItem('fkrtradeprice', tradePriceInput.value);
        }
        
        // localStorage에서 템플릿 불러오는 함수
        function loadTemplates() {
            const savedTemplates = localStorage.getItem('fkrtmps');
            if (savedTemplates) {
                try {
                    const templates = JSON.parse(savedTemplates);
                    
                    // 기존 템플릿 항목 제거
                    templateList.innerHTML = '';
                    resultList.innerHTML = '';
                    
                    // 저장된 템플릿이 없으면 기본 템플릿 하나 추가
                    if (templates.length === 0) {
                        // addTemplateItem();
                        return;
                    }
                    
                    // 저장된 템플릿 로드
                    templates.forEach(template => {
                        addTemplateItem(template || '');
                    });
                } catch (e) {
                    console.error('템플릿 로드 중 오류 발생:', e);
                    // 오류 발생 시 기본 템플릿 하나 추가
                    templateList.innerHTML = '';
                    resultList.innerHTML = '';
                    // addTemplateItem();
                }
            } else {
                // 저장된 템플릿이 없으면 기본 템플릿 하나 추가
                // addTemplateItem();
            }
        }
        
        // localStorage에서 BASE_URL 불러오는 함수
        function loadBaseUrl() {
            const savedBaseUrl = localStorage.getItem('fkrbaseurl');
            if (savedBaseUrl) {
                baseUrlInput.value = savedBaseUrl;
            }
        }
        
        // localStorage에서 Ticker 불러오는 함수
        function loadTicker() {
            const savedTicker = localStorage.getItem('fkrticker');
            if (savedTicker) {
                tickerInput.value = savedTicker;
            }
        }
        
        // localStorage에서 Seq 불러오는 함수
        function loadSeq() {
            const savedSeq = localStorage.getItem('fkrseq');
            if (savedSeq) {
                seqInput.value = savedSeq;
            }
        }

        // localStorage에서 condTypeCd 불러오는 함수 추가
        function loadcondTypeCd() {
            const savedcondTypeCd = localStorage.getItem('fkrcondTypeCd');
            if (savedcondTypeCd) {
                condTypeCdInput.value = savedcondTypeCd;
            }
        }
        
        // localStorage에서 TopPrice 불러오는 함수
        function loadTopPrice() {
            const savedTopPrice = localStorage.getItem('fkrtopprice');
            if (savedTopPrice) {
                topPriceInput.value = savedTopPrice;
            }
        }
        
        // localStorage에서 BotmPrice 불러오는 함수
        function loadBotmPrice() {
            const savedBotmPrice = localStorage.getItem('fkrbotmprice');
            if (savedBotmPrice) {
                botmPriceInput.value = savedBotmPrice;
            }
        }
        
        // localStorage에서 TradePrice 불러오는 함수
        function loadTradePrice() {
            const savedTradePrice = localStorage.getItem('fkrtradeprice');
            if (savedTradePrice) {
                tradePriceInput.value = savedTradePrice;
            }
        }
        
        // 페이지 로드 시 저장된 데이터 불러오기
        loadBaseUrl();
        loadTicker();
        loadSeq();
        loadcondTypeCd(); // condTypeCd 로드
        loadTopPrice();
        loadBotmPrice();
        loadTradePrice();
        loadTemplates();
        
        // 초기 상태에서 모든 링크 업데이트
        updateAllLinks();
    }

    // DOM이 완전히 로드된 후 앱 초기화 함수 실행
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initApp);
    } else {
        initApp();
    }
</script>
</body>
</html>